{"version":3,"file":"camera.min.js","sources":["../src/camera.js"],"sourcesContent":["/**\n * Saves the image and ...\n * @param {video} video - The camera feedback\n * @param {canvas} canvas - The canvas where the image will be temporally saved\n * @param {string} title The title of the page where the photo is taken\n * @param {number} userId The id of the user\n * @returns Nothing\n */\nfunction save_image(video, canvas, title, userId) {\n    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);\n    const date = new Date();\n\n    const formatMinutes = (minutes) => {\n        const stringMinutes = minutes.toString();\n        if(stringMinutes.length == 1) {\n            return \"0\" + stringMinutes;\n        }\n        return stringMinutes;\n    };\n\n    const time = `${date.getHours()}:${formatMinutes(date.getMinutes())}`;\n    const url = \"http://www.localhost/moodle/blocks/simplecamera/api.php\";\n    const mockBody = {\n        photo: canvas.toDataURL(),\n        page:  title,\n        userId: userId,\n        time: time\n    };\n\n    console.log(mockBody);\n\n    fetch(url, {\n        method: \"POST\",\n        mode: \"no-cors\",\n        headers: {\n            \"Content-type\":\"application/json\"\n        },\n        body: JSON.stringify(mockBody)\n    });\n}\n\n/**\n * Get the current time value from local storage\n * @returns {number} A number that represents time.\n */\nfunction getFromLocalStorage() {\n    return parseInt(localStorage.getItem(\"timeTranscurred\"));\n}\n\n/**\n * Put a value of the local storage.\n * @param {number} seconds A number which represents the time transcurred in the timer\n */\nfunction pushToLocalStorage(seconds) {\n    localStorage.setItem(\"timeTranscurred\", seconds.toString());\n}\n\nexport const init = (timer, title, id) => {\n    let video = document.querySelector(\"#camera\");\n    let canvas = document.querySelector(\"#canvas\");\n    let save_button = document.querySelector(\"#save_button\");\n\n    navigator.mediaDevices.getUserMedia({ video: true, audio: false }).then((stream) => {\n        video.srcObject = stream;\n        video.play();\n    }).catch((error) => window.alert(error));\n\n    save_button.addEventListener('click', function() {\n        save_image(video, canvas);\n    });\n\n    if(getFromLocalStorage() === null || isNaN(getFromLocalStorage())) {\n        pushToLocalStorage(0);\n    }\n    setInterval(() => {\n        if(getFromLocalStorage()  === timer/1000) {\n            save_image(video, canvas, title, id);\n            pushToLocalStorage(0);\n        }else {\n            const aux = getFromLocalStorage();\n            pushToLocalStorage(aux+1);\n        }\n    }, 1000);\n};\n"],"names":["save_image","video","canvas","title","userId","getContext","drawImage","width","height","date","Date","time","getHours","minutes","stringMinutes","toString","length","formatMinutes","getMinutes","mockBody","photo","toDataURL","page","console","log","fetch","method","mode","headers","body","JSON","stringify","getFromLocalStorage","parseInt","localStorage","getItem","pushToLocalStorage","seconds","setItem","timer","id","document","querySelector","save_button","navigator","mediaDevices","getUserMedia","audio","then","stream","srcObject","play","catch","error","window","alert","addEventListener","isNaN","setInterval"],"mappings":"4EAQSA,WAAWC,MAAOC,OAAQC,MAAOC,QACtCF,OAAOG,WAAW,MAAMC,UAAUL,MAAO,EAAG,EAAGC,OAAOK,MAAOL,OAAOM,cAC9DC,KAAO,IAAIC,KAUXC,eAAUF,KAAKG,uBAREC,CAAAA,gBACbC,cAAgBD,QAAQE,kBACH,GAAxBD,cAAcE,OACN,IAAMF,cAEVA,eAGwBG,CAAcR,KAAKS,eAEhDC,SAAW,CACbC,MAAOlB,OAAOmB,YACdC,KAAOnB,MACPC,OAAQA,OACRO,KAAMA,MAGVY,QAAQC,IAAIL,UAEZM,MAVY,0DAUD,CACPC,OAAQ,OACRC,KAAM,UACNC,QAAS,gBACU,oBAEnBC,KAAMC,KAAKC,UAAUZ,qBAQpBa,6BACEC,SAASC,aAAaC,QAAQ,6BAOhCC,mBAAmBC,SACxBH,aAAaI,QAAQ,kBAAmBD,QAAQtB,uGAGhC,CAACwB,MAAOpC,MAAOqC,UAC3BvC,MAAQwC,SAASC,cAAc,WAC/BxC,OAASuC,SAASC,cAAc,WAChCC,YAAcF,SAASC,cAAc,gBAEzCE,UAAUC,aAAaC,aAAa,CAAE7C,OAAO,EAAM8C,OAAO,IAASC,MAAMC,SACrEhD,MAAMiD,UAAYD,OAClBhD,MAAMkD,UACPC,OAAOC,OAAUC,OAAOC,MAAMF,SAEjCV,YAAYa,iBAAiB,SAAS,WAClCxD,WAAWC,MAAOC,YAGO,OAA1B8B,uBAAkCyB,MAAMzB,yBACvCI,mBAAmB,GAEvBsB,aAAY,QACL1B,wBAA2BO,MAAM,IAChCvC,WAAWC,MAAOC,OAAQC,MAAOqC,IACjCJ,mBAAmB,OACjB,CAEFA,mBADYJ,sBACW,MAE5B"}